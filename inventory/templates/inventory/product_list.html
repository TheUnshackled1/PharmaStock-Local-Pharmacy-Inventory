
<!DOCTYPE html>
{% load static %}
<html>
<head>
    <title>StockTime</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <script src="{% static 'script.js' %}"></script>
</head>
<body>
    <h1 class="main-title">PharmaStock | Local Pharmacy Inventory</h1>

    {% if low_stock_count > 0 %}
        <div class="low-stock-alert">
            <p>You have {{ low_stock_count }} product(s) running low on stock. <a href="{% url 'low_stock' %}">View them here</a>.</p>
        </div>
    {% endif %}

            
        <div class="nav-links">
            <a href="{% url 'expired_products' %}" class="nav-btn expired">Expired Products</a>
            <span class="divider">|</span>
            <a href="{% url 'expiring_soon' %}" class="nav-btn expiring">Expiring Soon</a>
            <span class="divider">|</span>
            <a href="{% url 'low_stock' %}" class="nav-btn low-stock">Low Stock</a>
        </div>

        <div style="text-align:center; margin-bottom: 16px;">
                <a href="{% url 'product_add' %}" class="nav-btn" style="margin-right: 8px;">Add Product</a>
                <a href="/admin/" class="nav-btn" style="background-color: #1976d2; color: white; margin-right: 8px;">Admin Panel</a>
                <a href="{% url 'customer_product_list' %}" class="nav-btn" style="background-color: #838080ff; color: white;">Check Shop</a>
                <a href="{% url 'income_report' %}" class="nav-btn" style="background-color: #4CAF50; color: white;">Income Report</a>
                <a href="{% url 'sales_forecast' %}" class="nav-btn" style="background-color: #ff9800; color: white;">Sales Forecast</a>
                <a href="{% url 'manage_returns' %}" class="nav-btn" style="background-color: #f44336; color: white;">Manage Returns</a>
                <a href="{% url 'logout' %}" class="nav-btn" style="background-color: #424242; color: white;">Logout</a>
        </div>

        
    <table border="1">

         <tr>
            <th>Name</th><th>Image</th><th>Category</th><th>Qty</th><th>Price</th><th>Expiry</th><th>Status</th><th>Actions</th>
        </tr>
        {% for product in products %}
        <tr style="background-color: {% if product.status == 'Expired' %}#f88{% elif product.status == 'Expiring Soon' %}#ff8{% elif product.status == 'Low Stock' %}#ffcc80{% else %}#8f8{% endif %}">
            <td>{{ product.name }}</td>
            <td>
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" width="100">
                {% else %}
                    No Image
                {% endif %}
            </td>
            <td>{{ product.category }}</td>
            <td>{{ product.quantity }}</td>
            <td>â‚±{{ product.price|floatformat:2 }}</td>
            <td>{{ product.expiry_date }}</td>
            <td>{{ product.status }}</td>
            <td>
                <a href="{% url 'product_edit' product.pk %}" class="nav-btn">Edit</a>
                <a href="{% url 'product_delete' product.pk %}" class="nav-btn expired">Delete</a>
                <button class="nav-btn view-barcode-btn" data-product-pk="{{ product.pk }}">View Barcode</button>
            </td>
        </tr>
        {% endfor %}
    </table>

        <script>
        // Highlight row on hover
        document.querySelectorAll('table tr').forEach(function(row, idx) {
            if(idx === 0) return; // skip header
            row.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 2px 8px #1976d2';
                this.style.transform = 'scale(1.01)';
            });
            row.addEventListener('mouseleave', function() {
                this.style.boxShadow = '';
                this.style.transform = '';
            });
        });

        // Barcode Modal Logic
        const barcodeModal = document.getElementById('barcodeModal');
        const barcodeImage = document.getElementById('barcodeImage');
        const closeModal = document.querySelector('.close-button');
        const viewBarcodeButtons = document.querySelectorAll('.view-barcode-btn');

        viewBarcodeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.dataset.productPk;
                barcodeImage.src = `/barcode/${productId}/`; // Assuming your barcode URL is /barcode/<pk>/
                barcodeModal.style.display = 'block';
            });
        });

        closeModal.addEventListener('click', function() {
            barcodeModal.style.display = 'none';
            barcodeImage.src = ''; // Clear image source
        });

        window.addEventListener('click', function(event) {
            if (event.target == barcodeModal) {
                barcodeModal.style.display = 'none';
                barcodeImage.src = ''; // Clear image source
            }
        });
    </script>

    <!-- Barcode Modal HTML -->
    <div id="barcodeModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Product Barcode</h2>
            <img id="barcodeImage" src="" alt="Product Barcode" style="max-width: 100%; height: auto;">
        </div>
    </div>

    <!-- Inline CSS for Modal (will be moved to styles.css later) -->
    <style>
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 500px;
            border-radius: 8px;
            position: relative;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 15px;
            top: 5px;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</body>
</html>
